# Stoat Migration Tool (Discord Terminator) - LLM Context

This file provides context for LLMs working on this repository.

## Project Overview
Discord Terminator is a specialized migration tool designed to clone Discord server structures (roles, categories, channels) and migrate message history (including attachments, rich formatting, and masqueraded identities) to Stoat (a chat platform based on Revolt).

## Tech Stack
- **Backend**: Node.js (Express, `discord.js`)
- **Frontend**: React (Vite, Tailwind-ish vanilla CSS)
- **Discord Integration**: `discord.js`
- **Stoat Integration**: Direct REST API calls via `axios`

## Key Modules
- `src/backend/server.js`: Express entry point, handles configuration, status, and initiates background engine tasks.
- `src/backend/engine.js`: The core migration logic. Handles Discord client login, history fetching, and Stoat API interactions.
- `src/frontend/src/App.jsx`: The single-page wizard UI.

## Important Architectural Patterns
1. **Engine Tasks**: Migration and Cloning are long-running background tasks. They emit status updates via WebSockets.
2. **WebSocket Logs**: The frontend connects to `/ws/logs/<task_id>` to receive real-time updates from the engine.
3. **Stoat API Specifics**: 
   - Uses `X-Bot-Token` header for authentication.
   - Channel discovery requires fetching the server object first to get channel IDs, then fetching individual channels.
   - Core ID field is `_id` (not `id`).
   - Text channels have `channel_type: "TextChannel"`.

## Common Pitfalls
- **Stoat CDN**: Attachments must be uploaded to the Autumn CDN (`https://cdn.stoatusercontent.com`) before being referenced in message payloads.
- **Masquerade**: Stoat supports "masquerading" (sending messages as a specific name/avatar). The tool uses this to preserve Discord identities.
- **Rate Limits**: Both Discord and Stoat have strict rate limits. The engine includes delay logic and handles 429 errors.
- **WebSocket Path**: Ensure the WebSocket path matches `/ws/logs/<task_id>` on the server.

## Workspace Structure
- `src/backend/`: Node.js Express server and migration engine.
- `src/frontend/`: React frontend.
- `start_LINUX_MAC.sh`: Universal launcher.
